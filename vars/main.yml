---
install_packages:
  - 'sudo'
  - 'acl'               # http://docs.ansible.com/ansible/latest/become.html#becoming-an-unprivileged-user
#  - 'python-setuptools' # 2019-10-16 - Something in the python packages for the
                        # transmission roles wants this, or it gives:
                        # "ImportError: No module named pkg_resources"
install_files:
  - owner:              'root'
    group:              'root'
    mode:               '0440'
    src:                'files/sudoers.d/ansible'
    dest:               '/etc/sudoers.d/ansible'
system_groups:
  - 'ansible'
system_users:
  - 'ansible'
lines_in_files:
  - line:               'ansible:*:\1'
    regexp:             '^ansible:[^:*][^:]*:(.*)$'
    dest:               '/etc/shadow'
    backrefs:           'yes'
authorized_keys:
  - user:               'ansible'
    keyfile:            "{{ role_path }}/../../inventory/hosts/synapse/users/ansible/files/ssh_keys/id_rsa.pub"
  - user:               'ansible'
    keyfile:            "{{ role_path }}/../../inventory/hosts/mawg/users/aaron/files/ssh_keys/id_rsa.pub"
allow_users:
  - 'ansible'
restart_services:
  - 'ssh'
